\documentclass{article}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{amssymb}
\usepackage{caption}
\usepackage{tikz}
\usepackage{color}
\usepackage{graphicx}
\usetikzlibrary{matrix}

\newlength\tindent
\setlength{\tindent}{\parindent}
\setlength{\parindent}{0pt}
\renewcommand{\indent}{\hspace*{\tindent}}

\begin{document}

\title{Estimating Reliability of EHR Data using a Dirichlet Process Prior}
\author{Jacob Carey}

\maketitle

\section{Introduction}

EHR data is not perfect. The "accuracy" of individual measurements is not perfect. One measure of this "accuracy" is \textbf{reliability}. \textit{definition and ref here}. Typically, reliability is estimated from data with repeat measurements. However, this idea is logistically impossible to implement in EHR data, as there is usually only one set of EHR data. Instead, one approach is to use a hierarchical model and calculate the "signal to noise" of the measure [ref]. \\

In our example, we have information about combination therapy for heart medication. We are interestd in calculating the reliability of this measure in EHR data. Here, we aggregate this binomial data by \textit{site}, a grouping of physicians in the same facility. According to [ref] we calculate the $\hat{\sigma}^2_{\text{binomial}}$ for each site and the between variance. A typical model choice for this problem is \textit{Beta-Binomial model} written

\begin{equation}\label{betabinom}
\theta_i \sim \text{Beta}(\alpha, \beta)
\end{equation}

where the variance between the souces follows the definition of a Beta distribution with the approximated $\alpha, \beta$ parameters. However, the problem with \eqref{betabinom} is that we force the typically uni-modal assumption on the underylying distribution of the $\theta$'s. A natural extension is to use a \textit{mixture of Beta} distributions for the hierarchical distribution.

\begin{equation}\label{eq:finitemix-betabinom}
\theta_i \sim \sum_i^K pi_i \times \text{Beta}(\alpha_k, \beta_k)
\end{equation}

\eqref{eq:finitemix-betabinom} allows for a more flexible hierarchical distribution. However, we have now introduced a different problem - how do you decide on $K$?

\section{Methods}

A solution arrives from the field of \textbf{Nonparametric Bayesian Statistics}. Instead of \eqref{eq:finitemix-betabinom}, a more relaxed choice is an \textit{infinite mixture model}

\begin{equation}\label{eq:infinitemix-betabinom}
\theta_i \sim \sum_i^{\infty} pi_i \times \text{Beta}(\alpha_k, \beta_k)
\end{equation}

In practice, an infinite mixture like \eqref{eq:infinitemix-betabinom} is implemented as a \textbf{Dirichlet Process}.

\begin{figure}
\centering
\begin{tikzpicture}

% write symbols
\matrix[matrix of math nodes, column sep=20pt, row sep=20pt] (mat)
{
    \alpha_k &[2em] & & & \\
    |[blue]|\pi_k & & \mu_{\mu_k} & & \sigma^2_{\mu_k}|\mu_{\mu_k} \\
    z_i & |[blue]|\sigma^2_k | \mu_{(k)} & & |[blue]|\mu_{(k)} \\[3em]
        & |[blue]|\theta_i \\
        & |[orange]|X_i \\
};

% draw arrows
\draw[->,>=latex] (mat-1-1) -- (mat-2-1);
\draw[->,>=latex] (mat-2-1) -- (mat-3-1);
\draw[->,>=latex] (mat-3-1) -- (mat-4-2);
\draw[->,>=latex] (mat-4-2) -- (mat-5-2);

\draw[->,>=latex] (mat-3-2) -- (mat-4-2);

\draw[->,>=latex] (mat-2-3) -- (mat-3-4);
\draw[->,>=latex] (mat-2-5) -- (mat-3-4);

\draw[->,>=latex] (mat-3-4) -- (mat-4-2);

\end{tikzpicture}
\captionof{figure}{Diagram of Mixture-of-Beta Binomial Model}
\label{fig:diagram}
\end{figure}


In Figure~\ref{fig:diagram}, we show the relationship of the parameters. For us, the parameters of interest are those highlighted in {\color{blue}blue}. The only portion of this diagram that is actually observed is the data, highlighted in {\color{orange}orange}. The rest of the parameters are nuisance parameters invented to improve the performance of the Markov Chain Monte Carlo.

Explicitly, we assume the data arrives to us as

\begin{equation}\label{eq:data}
    X_i \sim \text{Binom}(\theta_i, n_i)
\end{equation}

Next, we consider the $\theta$'s to be draws from a mixture of Beta's, each with their own $\alpha$ and $\beta$.

\begin{equation}\label{eq:theta}
    \theta_i \sim \text{Beta}(\alpha_k, \beta_k)
\end{equation}

Where the component of each $\theta_i$ is indicated by $z_i$. However, the reader will note that the diagram indicates that the Beta distributions for the $\theta_i$'s is parameterized in terms of $\mu$ (mean) and $\sigma^2$ (variance). This is a somewhat artifical construction to improve mixing.

\section{Results}

\begin{figure}
\includegraphics{variance}
\captionof{figure}{Posterior Variance}
\end{figure}

\begin{figure}
\includegraphics{reliability}
\captionof{figure}{Reliability estimate}
\end{figure}

\section{Discussion}

We see that the between variance has a much tighter highest probaility density interval comparing the Dirichlet Process model to the baseline. Indeed, the between variance approximated by the relaxed Dirichlet Process model appears very similar to the Beta-Mixture model with no model misspecification. Similarly, the credible interval of the reliability is much narrower with the Dirichlet Process than the Beta-Binomial model.

In this example, the semiparametric Dirichlet Process approach has a seemingly large improvement over the misspecificed Beta-Binomial Model. However, the reader may note that the scale of the ranges is very small, and this difference is not meaningfully large. Of note though, often times EHR data has worse resolution data in some fashion. For example, the size of the sites may be much smaller, or the number of sites may not be as large. Due  to this issue, any reduction in posterior variance through avoiding model misspecification is helpful in a real life example.

\end{document}
